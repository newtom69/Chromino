function InitDom(){GetPlayersInfos();ShowButtonChat();RefreshButtonNextGame();$("#MemoAdd").click(AddMemo);$("#ChatAdd").click(ChatAddMessage);$(".doAction").click(function(){Action(this.id)});$("#TipClose").click(function(){TipClosePopup("#TipPopup","#TipDontShowAgain")});HistoryChrominos.UpdateSquares=function(n,t,r){this.forEach(function(u){if(u.square0!==undefined)for(i=0;i<3;i++){squareProp="square"+i;oldNumber=parseInt(u[squareProp].replace("Square_",""));switch(r){case"top":u[squareProp]="Square_"+(oldNumber+n*t);break;case"right":u[squareProp]="Square_"+(oldNumber+n*Math.floor(oldNumber/t));break;case"left":u[squareProp]="Square_"+(oldNumber+n*(1+Math.floor(oldNumber/t)))}}})};Action("Welcome");RefreshVar();Players.forEach(function(n){UpdateInHandNumberDom(n)});RefreshInfoPopup();$("#ButtonPreviousChromino").click(function(){Tips.find(n=>n.elementId=="HistoryChrominos")==undefined&&(IndexMove<HistoryChrominos.length-1&&IndexMove++,AnimateChromino(2,!0),HideChrominosPlayed())});$("#ButtonNextChromino").click(function(){Tips.find(n=>n.elementId=="HistoryChrominos")==undefined&&(IndexMove>0&&IndexMove--,AnimateChromino(2,!0))});$(document).click(function(){IsPlayingBackEnd||(StopDraggable(),StartDraggable())});$(document).mouseup(function(){MagnetChromino()});$(window).resize(function(){ResizeGameArea()});window.oncontextmenu=function(n){n.preventDefault();n.stopPropagation()};$("#ChatInput").on("keydown",function(n){n.which==13&&ChatAddMessage()});ChatGetMessages(!1);$(".emoji").click(function(){let t=$("#ChatInput").prop("selectionStart"),n=$("#ChatInput").val(),i=n.substring(0,t),r=n.substring(t,n.length);$("#ChatInput").val(i+$(this).html()+r);$("#ChatInput").focus()})}function AnimateChromino(n,t,i){i&&(IndexMove=0);let r=t?IndexMove:0;if(HistoryChrominos.length!=0){ShowSquare("#"+HistoryChrominos[r].square0);ShowSquare("#"+HistoryChrominos[r].square1);ShowSquare("#"+HistoryChrominos[r].square2);for(let t=0;t<n;t++)AnimateSquare("#"+HistoryChrominos[r].square0),AnimateSquare("#"+HistoryChrominos[r].square1),AnimateSquare("#"+HistoryChrominos[r].square2);t&&($("#InfoGame").html(""),$("#PlayerHistoryPseudo").css("opacity","1"),$("#PlayerHistoryPseudo").dequeue(),$("#PlayerHistoryPseudo").html(HistoryChrominos[r].infoPlayerPlay).fadeIn().delay(1e3).fadeOut())}}function ShowLastChrominoPlayed(){AnimateChromino(0)}function AnimateSquare(n){$(n).fadeToggle(170,function(){$(this).fadeToggle(170)})}function HideChrominosPlayed(){IndexMove>0&&(HideSquare("#"+HistoryChrominos[IndexMove-1].square0),HideSquare("#"+HistoryChrominos[IndexMove-1].square1),HideSquare("#"+HistoryChrominos[IndexMove-1].square2))}function HideSquare(n){let t="#"+$(n).parent().attr("id"),o="#"+$(t).prev().attr("id"),s="#"+$(t).next().attr("id"),h=$(n).index()+1,i=" :nth-child("+h+")",r=$(o+i),u=$(s+i),f=$(n).prev(),e=$(n).next();$(n).addClass("OpenAll CloseNone Free");$(f).hasClass("Free")?$(f).removeClass("CloseRight"):$(n).addClass("CloseLeft");$(e).hasClass("Free")?$(e).removeClass("CloseLeft"):$(n).addClass("CloseRight");$(r).hasClass("Free")?$(r).removeClass("CloseBottom"):$(n).addClass("CloseTop");$(u).hasClass("Free")?$(u).removeClass("CloseTop"):$(n).addClass("CloseBottom")}function ShowSquare(n){let t="#"+$(n).parent().attr("id"),o="#"+$(t).prev().attr("id"),s="#"+$(t).next().attr("id"),h=$(n).index()+1,i=" :nth-child("+h+")",r=$(o+i),u=$(s+i),f=$(n).prev(),e=$(n).next();$(f).hasClass("Free")?$(f).addClass("CloseRight"):$(n).removeClass("CloseLeft");$(e).hasClass("Free")?$(e).addClass("CloseLeft"):$(n).removeClass("CloseRight");$(r).hasClass("Free")?$(r).addClass("CloseBottom"):$(n).removeClass("CloseTop");$(u).hasClass("Free")?$(u).addClass("CloseTop"):$(n).removeClass("CloseBottom");$(n).removeClass("OpenAll CloseNone Free")}function StartDraggable(){if(Tips.find(n=>n.elementId=="Hand")==undefined)$(".handPlayerChromino").draggableTouch().on("dragstart",function(){$(this).css("cursor","grabbing");ScheduleRotate();LastChrominoMove=this;PositionLastChromino=$(LastChrominoMove).offset();SchedulePut();StopScheduleValidateChromino()}).on("dragend",function(){!IsChrominoInGameArea(this)||PlayerId!=PlayerTurn.id||IsPlayingBackEnd||IsGameFinish?HideButtonPlayChromino():(ShowButtonPlayChromino(),ScheduleValidateChromino());$(this).css("cursor")=="grabbing"&&$(this).css("cursor","grab");LastChrominoMove=this;OffsetLastChromino=$(this).offset();MagnetChromino();ToRotate&&(ToRotate=!1,clearTimeout(TimeoutRotate),Rotation(LastChrominoMove));let n=$(LastChrominoMove).offset();ToPut&&PositionLastChromino.left==n.left&&PositionLastChromino.top==n.top&&(clearTimeout(TimeoutPut),PlayingChromino());ToPut=!1})}function StopDraggable(n){Tips.find(n=>n.elementId=="Hand")==undefined&&($(this).off("mouseup"),$(this).off("mousedown"),$(document).off("mousemove"),n===undefined?$(".handPlayerChromino").draggableTouch("disable"):$(n).draggableTouch("disable"))}function ScheduleRotate(){ToRotate=!0;clearTimeout(TimeoutRotate);TimeoutRotate=setTimeout(function(){ToRotate=!1},120)}function SchedulePut(){PlayerTurn.id!=PlayerId||IsPlayingBackEnd||(clearTimeout(TimeoutPut),PositionLastChromino=$(LastChrominoMove).offset(),TimeoutPut=setTimeout(function(){let n=$(LastChrominoMove).offset();PositionLastChromino.left==n.left&&PositionLastChromino.top==n.top&&(ToPut=!0,ShowOkToPut())},600))}function ShowOkToPut(){$("#GameArea").fadeToggle(25,function(){$(this).fadeToggle(25)});$(LastChrominoMove).fadeToggle(25,function(){$(this).fadeToggle(25)})}function MagnetChromino(){if(LastChrominoMove!=null){let n=$(LastChrominoMove).offset(),t=n.left-GameAreaOffsetX,i=n.top-GameAreaOffsetY,r=SquareSize*Math.round(t/SquareSize)-t,u=SquareSize*Math.round(i/SquareSize)-i;$(LastChrominoMove).css({left:"+="+r+"px",top:"+="+u+"px"})}}function Rotation(n){let t=90+GetAngle(n);t>=360&&(t-=360);SetAngle(n,t);GetOrientation(n)=="horizontal"?SetOffset(n,-SquareSize,0):SetOffset(n,SquareSize,0)}function SetOffset(n,t,i){let r=$(n).offset(),u=r.left+t,f=r.top+i;$(n).offset({top:f,left:u})}function GetOrientation(n){switch(GetAngle(n)){case 0:case 180:return"horizontal";case 90:case 270:return"vertical"}}function GetAngle(n){switch($(n).css("flex-direction")){case"row":return 0;case"column":return 90;case"row-reverse":return 180;case"column-reverse":default:return 270}}function SetAngle(n,t){let i="#"+$(n).attr("id");SetAngleByClass(i,t)}function SetAngleByClass(n,t){switch(t){case 0:$(n).css("flex-direction","row");$(n+" div:nth-child(1)").removeClass("OpenTop").addClass("OpenRight");$(n+" div:nth-child(2)").removeClass("OpenBottomTop").addClass("OpenRightLeft");$(n+" div:nth-child(3)").removeClass("OpenBottom").addClass("OpenLeft");break;case 90:$(n).css("flex-direction","column");$(n+" div:nth-child(1)").removeClass("OpenRight").addClass("OpenBottom");$(n+" div:nth-child(2)").removeClass("OpenRightLeft").addClass("OpenBottomTop");$(n+" div:nth-child(3)").removeClass("OpenLeft").addClass("OpenTop");break;case 180:$(n).css("flex-direction","row-reverse");$(n+" div:nth-child(1)").removeClass("OpenBottom").addClass("OpenLeft");$(n+" div:nth-child(2)").removeClass("OpenBottomTop").addClass("OpenRightLeft");$(n+" div:nth-child(3)").removeClass("OpenTop").addClass("OpenRight");break;case 270:$(n).css("flex-direction","column-reverse");$(n+" div:nth-child(1)").removeClass("OpenLeft").addClass("OpenTop");$(n+" div:nth-child(2)").removeClass("OpenRightLeft").addClass("OpenBottomTop");$(n+" div:nth-child(3)").removeClass("OpenRight").addClass("OpenBottom")}}function ResizeGameArea(){var u=$(document).width(),f=$(document).height(),n=u,t=f,i=0,r;n>t?(n-=200,SquareSize=Math.min(Math.trunc(Math.min(t/GameAreaLinesNumber,n/GameAreaColumnsNumber)),30),$(".handPlayerChromino").css({left:u-SquareSize*4}),$(".handPlayerChromino").each(function(){$(this).css({top:i});i+=SquareSize+Math.floor(SquareSize/10)}),SetAngleByClass(".handPlayerChromino",0)):(t-=200,SquareSize=Math.min(Math.trunc(Math.min(t/GameAreaLinesNumber,n/GameAreaColumnsNumber)),30),$(".handPlayerChromino").css({top:f-SquareSize*3}),$(".handPlayerChromino").each(function(){$(this).css({left:i});i+=SquareSize+Math.floor(SquareSize/10)}),SetAngleByClass(".handPlayerChromino",90));$("#GameArea").height(SquareSize*GameAreaLinesNumber);$("#GameArea").width(SquareSize*GameAreaColumnsNumber);$(".gameLineArea").outerHeight("auto");$(".Square").outerHeight(SquareSize);$(".Square").outerWidth(SquareSize);$(".handPlayerChromino").outerHeight(SquareSize);$("#GameArea").show();$(".gameLineArea").css("display","flex");r=$("#GameArea").offset();GameAreaOffsetX=r.left;GameAreaOffsetY=r.top;OffsetGameArea=$("#GameArea").offset()}function IsChrominoInGameArea(n){let f=1.5*SquareSize,i,r,u;GetOrientation(n)=="horizontal"?(i=1.5*SquareSize,r=-.5*SquareSize,u=1.5*SquareSize):(i=-.5*SquareSize,r=.5*SquareSize,u=.5*SquareSize);let e=$("#GameArea").height(),o=$("#GameArea").width(),t=$(n).offset();return t.left+i>OffsetGameArea.left&&t.left+f<OffsetGameArea.left+o&&t.top+r>OffsetGameArea.top&&t.top+u<OffsetGameArea.top+e?!0:!1}function ShowPopup(n,t=true){if(StopScheduleValidateChromino(),$(n).show(),$(n).popup({closebutton:t,autoopen:!0,transition:"all 0.4s"}),$.fn.popup.defaults.pagecontainer="#page",n=="#PopupChat"){ChatReadMessages();$("#ChatPopupContent").scrollTop(300);let n;clearTimeout(n);n=setTimeout(function(){$("#ChatPopupContent").scrollTop($("#ChatPopupContent")[0].scrollHeight)},50)}}function ClosePopup(n){$(n).popup("hide")}function ScheduleValidateChromino(){clearTimeout(TimeoutValidateChromino);TimeoutValidateChromino=setTimeout(function(){Action("ValidateChromino")},4e3)}function StopScheduleValidateChromino(){TimeoutValidateChromino&&(clearTimeout(TimeoutValidateChromino),TimeoutValidateChromino=0)}function ShowTipFeature(n,t){Tip.headPictureClass!=""?($("#TipHeadPicture").removeClass().addClass("div-head "+Tip.headPictureClass),$("#TipHeadPicture").show()):$("#TipHeadPicture").hide();$("#TipHtml").html(Tip.description);$("#TipDontShowAgain").prop("checked",n);Tip.illustrationPictureClass!=""?($("#TipIllustration").removeClass().addClass("illustration "+Tip.illustrationPictureClass),$("#TipIllustration").show()):$("#TipIllustration").hide();ShowPopup("#TipPopup",t)}function Action(n){Tip=Tips.find(t=>t.elementId==n);let t=n.replace("Button",""),i="#Form"+t,r="#Popup"+t;Tip!=undefined?ShowTipFeature(!0,!1):typeof window[t]=="function"?window[t]():$(r).length?ShowPopup(r):$(i).length&&$(i).submit()}function ErrorReturn(n){let t=PlayErrors.findIndex(t=>t.name==n);t>=0&&($("#ErrorText").html(PlayErrors[t].description),$("#ErrorIllustration").removeClass().addClass("illustration "+PlayErrors[t].illustrationPictureClass),$("#ErrorIllustrationCaption").html(PlayErrors[t].illustrationPictureCaption),PlayErrors[t].illustrationPictureClass!=""?($("#ErrorIllustration").show(),$("#ErrorIllustrationCaption").show()):($("#ErrorIllustration").hide(),$("#ErrorIllustrationCaption").hide()),ShowPopup("#PopupError"));IsPlayingBackEnd=!1}function HaveBotResponsability(){var n;let t=Players.findIndex(n=>n.id==PlayerId),i=Players.findIndex(n=>n.id==PlayerTurn.id);if(t<i){for(n=t+1;n<=i;n++)if(!Players[n].isBot)return!1}else{for(n=t+1;n<Players.length;n++)if(!Players[n].isBot)return!1;for(n=0;n<=i;n++)if(!Players[n].isBot)return!1}return!0}function RefreshDom(n){HaveBotResponsability()&&PlayingBot(PlayerTurn.id);StopScheduleValidateChromino();n&&ShowHistoryLatestMove();RefreshButtonNextGame();RefreshButtonMemo();RefreshButtonsDrawSkip();RefreshHelp();RefreshInfoPopup();ResizeGameArea();StopDraggable();StartDraggable();IsGameFinish&&(HideButtonPlayChromino(),RefreshButtonNextGame(),StopDraggable())}function RefreshInfoPopup(){if(IsGameFinish)Players.find(n=>n.id==PlayerId)!==undefined&&(html=Players.find(n=>n.id==PlayerId).chrominosNumber!=0?"<h2>Vous avez perdu<\/h2><h3>Dommage<\/h3><br />":Players.findIndex(n=>n.id!=PlayerId&&n.chrominosNumber==0)!=-1?"<h2>Victoire ex-æquo <\/h2><h3>Bravo<\/h3><br />":"<h2>Victoire<\/h2><h3>Bravo !<\/h3><br />",$("#PopupInfoHead").html(html));else{let n=PlayerTurn.id==PlayerId?"C'est à vous de jouer":`C'est à ${PlayerTurn.name} de jouer`;$("#PopupInfoHead").html(`<h3>${n}</h3>`)}RefreshInStack();(ShowInfoPopup&&PlayerTurn.id==PlayerId||IsGameFinish)&&ShowPopup("#PopupInfo")}function RefreshInStack(){switch(InStack){case 0:$("#InStack").html("Il n'y a plus de chrominos dans la pioche");break;case 1:$("#InStack").html("Pioche : 1 chromino");break;default:$("#InStack").html(`Pioche : ${InStack} chrominos`)}}function UpdateInHandNumberDom(n){let t=n.id==PlayerId?"Vous avez":n.name+" a";$("#Player_"+n.id).removeClass();switch(n.chrominosNumber){case 0:$("#Player_"+n.id).addClass("winner");$("#Player_"+n.id).html(`${t} terminé`);break;case 1:$("#Player_"+n.id).addClass("opponentLastChromino");let i=t+"&nbsp";for(let t=0;t<3;t++){let r;switch(t){case 0:r="OpenRight";break;case 1:r="OpenRightLeft";break;case 2:r="OpenLeft"}i+=`<div class="Square ${r} ${n.lastChrominoColors[t]}"></div>`}$("#Player_"+n.id).html(i);break;default:$("#Player_"+n.id).html(`${t} ${n.chrominosNumber} chrominos en main`)}}function AddChrominoInHand(n){let t=`<div id="${n.id}" class="handPlayerChromino">`;for(let i=0;i<3;i++)t+=`<div class="Square ${n.colors[i]}"></div>`;t+="<\/div>";$(t).appendTo("#Hand");ResizeGameArea()}function AddChrominoInGame(n,t){let i=n;i.yIndex==GameAreaLinesNumber-2&&i.orientation==Horizontal||i.yIndex==GameAreaLinesNumber-4&&i.orientation==Vertical?AddGameLineBottom(1):i.yIndex==GameAreaLinesNumber-3&&i.orientation==Vertical?AddGameLineBottom(2):i.yIndex<2&&(AddGameLineTop(2-i.yIndex),i.yIndex=2);i.xIndex==GameAreaColumnsNumber-2&&i.orientation==Vertical||i.xIndex==GameAreaColumnsNumber-4&&i.orientation==Horizontal?AddGameColumnRight(1):i.xIndex==GameAreaColumnsNumber-3&&i.orientation==Horizontal?AddGameColumnRight(2):i.xIndex<2&&(AddGameColumnLeft(2-i.xIndex),i.xIndex=2);let u=[];offset=i.orientation==Horizontal?{x:1,y:0}:{x:0,y:1};for(var r=0;r<3;r++){index=i.xIndex+offset.x*r+(i.yIndex+offset.y*r)*GameAreaColumnsNumber;squareName="Square_"+index;u.push(squareName);squareSelector="#"+squareName;switch(r){case 0:classColor=i.flip?i.colors[2]:i.colors[0];classOpenSides=i.orientation==Horizontal?"Square OpenRight":"Square OpenBottom";break;case 1:classColor=i.colors[1];classOpenSides=i.orientation==Horizontal?"Square OpenRightLeft":"Square OpenBottomTop";break;case 2:classColor=i.flip?i.colors[0]:i.colors[2];classOpenSides=i.orientation==Horizontal?"Square OpenLeft":"Square OpenTop"}$(squareSelector).removeClass().addClass(classOpenSides+" "+classColor)}AddHistoryPlay(t,u);ShowLastChrominoPlayed();ResizeGameArea()}function AddHistoryPlay(n,t){HistoryChrominos.splice(0,0,{infoPlayerPlay:n,square0:t[0],square1:t[1],square2:t[2]})}function AddHistorySkipTurn(n){HistoryChrominos.splice(0,0,{infoPlayerPlay:n})}function AddGameLineBottom(n){for(let t=0;t<n;t++){let t=GameAreaLinesNumber*GameAreaColumnsNumber,n=`<div id="Line_${GameAreaLinesNumber}" class="gameLineArea">`;for(let i=0;i<GameAreaColumnsNumber;i++)n+=`<div id="Square_${t+i}" class="Square Free"></div>`;n+="<\/div>";$(n).appendTo("#GameArea");GameAreaLinesNumber++}}function AddGameLineTop(n){for(let t=0;t<n;t++){$("div[id^='Line_']").each(function(n){this.id="Line_"+(n+1)});$("div[id^='Line_']").children(".Square").each(function(n){this.id="Square_"+(GameAreaColumnsNumber+n)});let n=`<div id="Line_0" class="gameLineArea">`;for(let t=0;t<GameAreaColumnsNumber;t++)n+=`<div id="Square_${t}" class="Square Free"></div>`;n+="<\/div>";$("#GameArea").prepend(n);GameAreaLinesNumber++;YMin--}HistoryChrominos.UpdateSquares(n,GameAreaColumnsNumber,"top")}function AddGameColumnLeft(n){let t=GameAreaColumnsNumber;for(let t=0;t<n;t++)$("div[id^='Line_']").each(function(n){let t=(GameAreaColumnsNumber+1)*n,i=`<div id="Square_${t}" class="Square Free"></div>`,r="#Line_"+n;$(r).children(".Square").each(function(n){this.id="Square_"+(t+n+1)});$(this).prepend(i)}),GameAreaColumnsNumber++,XMin--;HistoryChrominos.UpdateSquares(n,t,"left")}function AddGameColumnRight(n){let t=GameAreaColumnsNumber;for(let t=0;t<n;t++)$("div[id^='Line_']").each(function(n){let t=n*(GameAreaColumnsNumber+1)+GameAreaColumnsNumber,i=`<div id="Square_${t}" class="Square Free"></div>`;$(i).appendTo(this);let r="#Line_"+(n+1);$(r).children(".Square").each(function(n){this.id="Square_"+(t+n+1)})}),GameAreaColumnsNumber++;HistoryChrominos.UpdateSquares(n,t,"right")}function RemoveChrominoInHand(n){$("#"+n).remove()}function RefreshButtonNextGame(){OpponentsAllBots||PlayerTurn.isBot||PlayerId==PlayerTurn.id?$("#ButtonNextGame").hide():$("#ButtonNextGame").show()}function RefreshButtonsDrawSkip(){IsGameFinish?($("#ButtonDrawChromino").hide(),$("#ButtonSkipTurn").hide()):PlayerTurn.id!=PlayerId?($("#ButtonDrawChromino").hide(),$("#ButtonSkipTurn").hide()):InStack>0&&(!HaveDraw||PlayersNumber==1)?($("#ButtonDrawChromino").show(),$("#ButtonSkipTurn").hide()):($("#ButtonDrawChromino").hide(),$("#ButtonSkipTurn").show())}function ShowButtonPlayChromino(){$("#ButtonPlayingChromino").show()}function HideButtonPlayChromino(){$("#ButtonPlayingChromino").hide()}function ShowButtonChat(){OpponentsAllBots||$("#ButtonChat").show()}function HideButtonChat(){$("#ButtonChat").hide()}function RefreshButtonHelp(){HelpNumber==0||IsGameFinish?$("#ButtonHelp").hide():($("#HelpNumber").text(HelpNumber),$("#ButtonHelp").show())}function RefreshButtonMemo(){MemosNumber!=0?($("#NotifMemo").text(MemosNumber),$("#NotifMemo").show()):$("#NotifMemo").hide()}function RefreshHelp(){if($(".Square").removeClass("Possible"),HelpIndexes.length>0){let n=HelpIndexes.map(n=>"#Square_"+n).join(", ");$(n).addClass("Possible");HelpIndexes=[]}RefreshButtonHelp()}function ShowHistoryLatestMove(){AnimateChromino(3,!0,!0)}function ShowWorkInProgress(){$("*").css("cursor","wait");$("#Waiting").show()}function ShowWorkIsFinish(){$("*").css("cursor","");$("#Waiting").hide()}function TipClosePopup(n,t){if($(t).is(":checked")){let n=!1;$("input[name=dontShowAllTips]").is(":checked")&&(n=!0);$.ajax({url:UrlTipOff,type:"POST",data:{gameId:GameId,tipId:Tip.id,dontShowAllTips:n},success:function(){CallbackTipClosePopup(n)}})}ClosePopup(n)}function AddMemo(){let n=$("#MemoContent").val();$.ajax({url:UrlMemoAdd,type:"POST",data:{gameId:GameId,memo:n},success:function(n){CallbackAddMemo(n)}})}function ChatAddMessage(){let n=$("#ChatInput").val();n!=""&&$.ajax({url:UrlChatPostMessage,type:"POST",data:{gameId:GameId,message:n},success:function(n){CallbackAddMessage(n)}})}function ChatGetMessages(n){$.ajax({url:UrlChatGetMessages,type:"POST",data:{gameId:GameId,newMessages:n},success:function(t){CallbackChatGetMessages(t,n)}})}function ChatReadMessages(){$("#NotifChat").text("0");$("#NotifChat").hide();$.ajax({url:UrlChatGetMessages,type:"POST",data:{gameId:GameId,newMessages:!0,resetNotification:!0},success:function(n){CallbackChatReadMessages(n)}})}function Help(){$(".Possible").length==0&&$.ajax({url:UrlHelp,type:"POST",data:{gameId:GameId},success:function(n){CallbackHelp(n)}})}function SkipTurn(){HideButtonPlayChromino();$.ajax({url:UrlSkip,type:"POST",data:{gameId:GameId},success:function(n){CallbackSkipTurn(n)}})}function DrawChromino(){$.ajax({url:UrlDraw,type:"POST",data:{gameId:GameId},success:function(n){CallbackDrawChromino(n)}})}function End(){$.ajax({url:UrlEnd,type:"POST",data:{gameId:GameId},success:function(n){CallbackEnd(n)}})}function GetPlayersInfos(){$.ajax({url:UrlPlayersInfos,type:"POST","async":!1,data:{gameId:GameId},success:function(n){CallbackGetPlayersInfos(n)}})}function GetInfosAfterPlaying(){$.ajax({url:UrlGetInfosAfterPlaying,type:"POST","async":!1,data:{gameId:GameId,playerId:PlayerTurn.id},success:function(n){TEST(n)}})}function TEST(n){TESTnextPlayerId=n.nextPlayerId;TESTlastChrominoColors=n.lastChrominoColors;TESTfinish=n.finish}function PlayingBot(n){if(!IsGameFinish){let t=Players.find(t=>t.id==n).name+" joue";$("#InfoGame").html(t).fadeIn();ShowWorkInProgress();$.ajax({url:UrlPlayBot,type:"POST",data:{id:GameId,botId:n},success:function(t){CallbackBotPlayed(t,n)}})}}function PlayingChromino(){if(ShowInfoPopup=!1,HideButtonPlayChromino(),!IsGameFinish&&LastChrominoMove!=null){IsPlayingBackEnd=!0;StopDraggable(LastChrominoMove);ShowWorkInProgress();let r=$(LastChrominoMove).offset(),u=Math.round((r.left-GameAreaOffsetX)/SquareSize),i=Math.round((r.top-GameAreaOffsetY)/SquareSize),f=LastChrominoMove.id,n,t;switch(GetAngle(LastChrominoMove)){case 0:n=Horizontal;t=!1;break;case 90:n=Vertical;t=!1;i--;break;case 180:n=Horizontal;t=!0;break;case 270:n=Vertical;t=!0;i--}let e=u+XMin,o=i+YMin;$.ajax({url:UrlPlay,type:"POST",data:{gameId:GameId,chrominoId:f,x:e,y:o,orientation:n,flip:t},success:function(r){CallbackPlayChromino(r,f,u,i,n,t)}})}}function CallbackChatGetMessages(n,t){t||$("#ChatPopupContent").val($("#ChatPopupContent").val()+n.chat);n.newMessagesNumber>0?($("#NotifChat").text(n.newMessagesNumber),$("#NotifChat").show()):$("#NotifChat").hide()}function CallbackChatReadMessages(n){$("#ChatPopupContent").val($("#ChatPopupContent").val()+n.chat)}function CallbackAddMessage(n){$("#ChatPopupContent").val($("#ChatPopupContent").val()+n.newMessage);$("#ChatInput").val("");SendMessageSent(Guid)}function CallbackTipClosePopup(n){n?Tips=[]:Tips.splice(Tips.findIndex(n=>n.id==Tip.id),1)}function CallbackAddMemo(n){ClosePopup("#PopupMemo");n.memosNumber!=0?($("#NotifMemo").text(n.memosNumber),$("#NotifMemo").show()):($("#NotifMemo").text(0),$("#NotifMemo").hide())}function CallbackHelp(n){n.indexes.length>0?(HelpIndexes=n.indexes,HelpNumber--):$("#InfoGame").html("Pas d'emplacements possibles").fadeIn().delay(1e3).fadeOut();RefreshHelp()}function CallbackDrawChromino(n){n.id===undefined?ErrorReturn(n.errorReturn):(HaveDraw=!0,ShowInfoPopup=!1,AddChrominoInHand(n),DecreaseInStack(),UpdateInHandNumber(PlayerId,1),StopDraggable(),StartDraggable(),!OpponentsAllBots&&Players.length>1&&SendChrominoDrawn(),RefreshDom())}function CallbackSkipTurn(n){n.id===undefined?ErrorReturn(n.errorReturn):(RefreshButtonNextGame(),AddHistorySkipTurn("Vous avez passé"),!OpponentsAllBots&&Players.length>1&&SendTurnSkipped(),RefreshVar(n),RefreshDom())}function CallbackPlayChromino(n,t,i,r,u,f){IsPlayingBackEnd=!1;ShowWorkIsFinish();n.nextPlayerId===undefined?ErrorReturn(n.errorReturn):(HideButtonPlayChromino(),AddChrominoInGame({xIndex:i,yIndex:r,orientation:u,flip:f,colors:n.colors},"Vous avez posé"),RemoveChrominoInHand(t),UpdateInHandNumber(PlayerId,-1,n.lastChrominoColors),!OpponentsAllBots&&Players.length>1&&SendChrominoPlayed({xIndex:i,yIndex:r,orientation:u,flip:f,colors:n.colors}),RefreshVar(n),RefreshDom())}function CallbackBotPlayed(n,t){$("#InfoGame").fadeOut();let i=Players.find(n=>n.id==t).name;if(n.draw&&(DecreaseInStack(),UpdateInHandNumber(t,1),i+=" a pioché et"),n.skip)AddHistorySkipTurn(i+" a passé"),!OpponentsAllBots&&Players.length>1&&SendBotTurnSkipped(n.draw);else{let r=n.x-XMin,u=n.y-YMin;AddChrominoInGame({xIndex:r,yIndex:u,orientation:n.orientation,flip:n.flip,colors:n.colors},i+" a posé");UpdateInHandNumber(t,-1,n.lastChrominoColors);!OpponentsAllBots&&Players.length>1&&SendBotChrominoPlayed({xIndex:r,yIndex:u,orientation:n.orientation,flip:n.flip,colors:n.colors},n.draw)}ShowWorkIsFinish();RefreshVar(n);RefreshDom(!0)}function CallbackEnd(n){let t="";Players.forEach(n=>t+=`<input name="playersName" value="${n.name}" />`);$(t).appendTo("#FormRematch");OpponentsAllBots?($("#Askrematch-text").html("Rejouer ?"),$("#Askrematch").show()):n.askRematch&&($("#Askrematch-text").html("Prendre votre revanche ?"),$("#Askrematch").show())}function CallbackGetPlayersInfos(n){Players=n.playersInfos;OpponentsAllBots=n.opponentsAllBots;Guid=n.guid}function DecreaseInStack(){InStack--;RefreshInStack()}function UpdateInHandNumber(n,t,i=undefined){let r=Players.find(t=>t.id==n);r.chrominosNumber+=t;r.chrominosNumber<=1&&(r.lastChrominoColors=i,r.id!=PlayerId&&(ShowInfoPopup=!0));UpdateInHandNumberDom(r)}function RefreshVar(n){n!==undefined&&(n.finish!==undefined&&(IsGameFinish=n.finish),ChangePlayerTurn());PlayerTurn.id!=PlayerId&&(HaveDraw=!1);IsGameFinish&&(ShowInfoPopup=!0,End())}function ChangePlayerTurn(){let t=Players.findIndex(n=>n.id==PlayerTurn.id),n=t+1<Players.length?t+1:0;PlayerTurn.id=Players[n].id;PlayerTurn.isBot=Players[n].isBot;PlayerTurn.name=Players[n].name}function CallSignalR(){ConnectionHubGame=(new signalR.HubConnectionBuilder).withUrl("/hubGame").withAutomaticReconnect().build();ConnectionHubGame.start().then(function(){SendAddToGroup(Guid)}).catch(function(n){return console.error(n.toString())});ConnectionHubGame.on("ReceiveMessageSent",function(n){OpponentMessageSent(n)});ConnectionHubGame.on("ReceiveChrominoPlayed",function(n){OpponentChrominoPlayed(n)});ConnectionHubGame.on("ReceiveTurnSkipped",function(){OpponentTurnSkipped()});ConnectionHubGame.on("ReceiveChrominoDrawn",function(){OpponentChrominoDrawn()});ConnectionHubGame.on("ReceiveBotChrominoPlayed",function(n,t){BotChrominoPlayed(n,t)});ConnectionHubGame.on("ReceiveBotTurnSkipped",function(n){BotTurnSkipped(n)})}function SendAddToGroup(){ConnectionHubGame.invoke("AddToGroup",Guid).catch(function(n){return console.error(n.toString())})}function SendMessageSent(){ConnectionHubGame.invoke("SendMessageSent",Guid).catch(function(n){return console.error(n.toString())})}function SendChrominoPlayed(n){ConnectionHubGame.invoke("SendChrominoPlayed",Guid,n).catch(function(n){return console.error(n.toString())})}function SendTurnSkipped(){ConnectionHubGame.invoke("SendTurnSkipped",Guid).catch(function(n){return console.error(n.toString())})}function SendChrominoDrawn(){ConnectionHubGame.invoke("SendChrominoDrawn",Guid).catch(function(n){return console.error(n.toString())})}function SendBotChrominoPlayed(n,t){ConnectionHubGame.invoke("SendBotChrominoPlayed",Guid,n,t).catch(function(n){return console.error(n.toString())})}function SendBotTurnSkipped(n){ConnectionHubGame.invoke("SendBotTurnSkipped",Guid,n).catch(function(n){return console.error(n.toString())})}function OpponentMessageSent(){$("#PopupChat").is(":visible")?ChatReadMessages():ChatGetMessages(!0)}function OpponentChrominoPlayed(n){GetInfosAfterPlaying();AddChrominoInGame(n,PlayerTurn.name+" a posé");let t={finish:TESTfinish,nextPlayerId:TESTnextPlayerId};UpdateInHandNumber(PlayerTurn.id,-1,TESTlastChrominoColors);RefreshVar(t);RefreshDom(!0)}function OpponentChrominoDrawn(){GetInfosAfterPlaying();$("#InfoGame").html(PlayerTurn.name+" pioche...").fadeIn().delay(1e3).fadeOut();DecreaseInStack();UpdateInHandNumber(PlayerTurn.id,1);RefreshDom()}function OpponentTurnSkipped(){GetInfosAfterPlaying();AddHistorySkipTurn(PlayerTurn.name+" a passé");let n={finish:TESTfinish,nextPlayerId:TESTnextPlayerId};RefreshVar(n);RefreshDom(!0)}function BotChrominoPlayed(n,t){GetInfosAfterPlaying();AddChrominoInGame(n,PlayerTurn.name+" a posé");let i={finish:TESTfinish,nextPlayerId:TESTnextPlayerId};t?DecreaseInStack():UpdateInHandNumber(PlayerTurn.id,-1,TESTlastChrominoColors);RefreshVar(i);RefreshDom(!0)}function BotTurnSkipped(n){GetInfosAfterPlaying();AddHistorySkipTurn(PlayerTurn.name+" a passé");n&&(DecreaseInStack(),UpdateInHandNumber(PlayerTurn.id,1));let t={finish:TESTfinish,nextPlayerId:TESTnextPlayerId};RefreshVar(t);RefreshDom(!0)}var Guid,TimeoutPut=null,ToPut=!1,PositionLastChromino,TimeoutRotate=null,ToRotate=!0,LastChrominoMove=null,OffsetLastChromino=0,OffsetGameArea=null,GameAreaOffsetX,GameAreaOffsetY,SquareSize,Tip,TimeoutValidateChromino=null,IndexMove=0,HelpIndexes=[],Players,IsPlayingBackEnd,OpponentsAllBots,TESTnextPlayerId,TESTlastChrominoColors,TESTfinish,ConnectionHubGame;$(document).ready(function(){InitDom();CallSignalR();RefreshDom()});
/*!
 * jQuery Popup Overlay
 *
 * @requires jQuery v1.7.1+
 * @link https://vast-engineering.github.com/jquery-popup-overlay/
 */
(function(n){var f=n(window),o={},u=[],e=[],h,s=null,c="_open",v="_close",i=[],l=null,a,p=/(iPad|iPhone|iPod)/.test(navigator.userAgent),w="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",t={_init:function(i){var r=n(i),f=r.data("popupoptions");e[i.id]=!1;u[i.id]=0;r.data("popup-initialized")||(r.attr("data-popup-initialized","true"),t._initonce(i));f.autoopen&&setTimeout(function(){t.show(i,0)},0)},_initonce:function(i){var u=n(i),a=n("body"),f,r=u.data("popupoptions"),v,y,e,o;if(s=parseInt(a.css("margin-right"),10),l=document.body.style.webkitTransition!==undefined||document.body.style.MozTransition!==undefined||document.body.style.msTransition!==undefined||document.body.style.OTransition!==undefined||document.body.style.transition!==undefined,r.scrolllock&&typeof h=="undefined"&&(v=n('<div style="width:50px;height:50px;overflow:auto"><div/><\/div>').appendTo("body"),y=v.children(),h=y.innerWidth()-y.height(99).innerWidth(),v.remove()),u.attr("id")||u.attr("id","j-popup-"+parseInt(Math.random()*1e8,10)),u.addClass("popup_content"),r.background&&!n("#"+i.id+"_background").length&&(a.append('<div id="'+i.id+'_background" class="popup_background"><\/div>'),e=n("#"+i.id+"_background"),e.css({opacity:0,visibility:"hidden",backgroundColor:r.color,position:"fixed",top:0,right:0,bottom:0,left:0}),r.setzindex&&!r.autozindex&&e.css("z-index","100000"),r.transition&&e.css("transition",r.transition)),a.append(i),u.wrap('<div id="'+i.id+'_wrapper" class="popup_wrapper" />'),f=n("#"+i.id+"_wrapper"),f.css({opacity:0,visibility:"hidden",position:"absolute"}),p&&(e=n("#"+i.id+"_background"),e.css("cursor","pointer"),n(r.pagecontainer).css("cursor","pointer")),r.type=="overlay"&&!r.absolute&&r.background&&(f.css("overflow","auto"),f[0].style.WebkitOverflowScrolling="touch"),u.css({opacity:0,visibility:"hidden","pointer-events":"auto",display:"inline-block"}),r.setzindex&&!r.autozindex&&f.css("z-index","100001"),r.outline||u.css("outline","none"),r.transition&&(u.css("transition",r.transition),f.css("transition",r.transition)),u.attr("aria-hidden",!0),r.type=="overlay"&&(u.css({textAlign:"left",position:"relative",verticalAlign:"middle"}),f.css({position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"}),f.append('<div class="popup_align" />'),n(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})),u.attr("role","dialog"),o=r.openelement?r.openelement:"."+i.id+c,n(o).each(function(t,i){n(i).attr("data-popup-ordinal",t);i.id||n(i).attr("id","open_"+parseInt(Math.random()*1e8,10))}),u.attr("aria-labelledby")||u.attr("aria-label")||u.attr("aria-labelledby",n(o).attr("id")),r.action=="hover"){r.keepfocus=!1;n(o).on("mouseenter",function(){t.show(i,n(this).data("popup-ordinal"))});n(o).on("mouseleave",function(){t.hide(i)})}else n(document).on("click.jqp",o,function(r){r.preventDefault();var u=n(this).data("popup-ordinal");setTimeout(function(){t.show(i,u)},0)});r.closebutton&&t.addclosebutton(i);r.detach?u.detach():u.hide()},show:function(o,c){var p=n(o),k,w;if(!p.data("popup-visible")){p.data("popup-initialized")||t._init(o);p.attr("data-popup-initialized","true");var d=n("body"),y=p.data("popupoptions"),b=n("#"+o.id+"_wrapper"),nt=n("#"+o.id+"_background");if(r(o,c,y.beforeopen),e[o.id]=c,setTimeout(function(){i.push(o.id)},0),y.autozindex){var tt=document.getElementsByTagName("*"),it=tt.length,g=0;for(k=0;k<it;k++)w=n(tt[k]).css("z-index"),w!=="auto"&&(w=parseInt(w,10),g<w&&(g=w));u[o.id]=g;y.background&&u[o.id]>=0&&n("#"+o.id+"_background").css({zIndex:u[o.id]+1});u[o.id]>=0&&b.css({zIndex:u[o.id]+2})}if(y.detach?(b.prepend(o),p.show()):p.show(),a=setTimeout(function(){b.css({visibility:"visible",opacity:1});n("html").addClass("popup_visible").addClass("popup_visible_"+o.id);b.addClass("popup_wrapper_visible")},20),y.scrolllock&&(d.css("overflow","hidden"),d.height()>f.height()&&d.css("margin-right",s+h)),p.css({visibility:"visible",opacity:1}),y.background&&(nt.css({visibility:"visible",opacity:y.opacity}),setTimeout(function(){nt.css({opacity:y.opacity})},0)),p.data("popup-visible",!0),t.reposition(o,c),p.data("focusedelementbeforepopup",document.activeElement),p.attr("tabindex",-1),setTimeout(function(){y.focuselement==="closebutton"?n("#"+o.id+" ."+o.id+v+":first").focus():y.focuselement?n(y.focuselement).focus():(y.focuselement===!0||y.keepfocus)&&p.focus()},y.focusdelay),y.keepfocus&&n(y.pagecontainer).attr("aria-hidden",!0),p.attr("aria-hidden",!1),r(o,c,y.onopen),l)b.one("transitionend",function(){r(o,c,y.opentransitionend)});else r(o,c,y.opentransitionend);if(y.type=="tooltip")n(window).on("resize."+o.id,function(){t.reposition(o,c)})}},hide:function(t,u){var c=n.inArray(t.id,i);if(c!==-1){a&&clearTimeout(a);var v=n("body"),f=n(t),o=f.data("popupoptions"),h=n("#"+t.id+"_wrapper"),y=n("#"+t.id+"_background");if(f.data("popup-visible",!1),i.length===1?n("html").removeClass("popup_visible").removeClass("popup_visible_"+t.id):n("html").hasClass("popup_visible_"+t.id)&&n("html").removeClass("popup_visible_"+t.id),i.splice(c,1),h.hasClass("popup_wrapper_visible")&&h.removeClass("popup_wrapper_visible"),o.keepfocus&&!u&&setTimeout(function(){n(f.data("focusedelementbeforepopup")).is(":visible")&&f.data("focusedelementbeforepopup").focus()},0),h.css({visibility:"hidden",opacity:0}),f.css({visibility:"hidden",opacity:0}),o.background&&y.css({visibility:"hidden",opacity:0}),n(o.pagecontainer).attr("aria-hidden",!1),f.attr("aria-hidden",!0),r(t,e[t.id],o.onclose),l&&f.css("transition-duration")!=="0s")f.one("transitionend",function(){f.data("popup-visible")||(o.detach?f.detach():f.hide());o.scrolllock&&setTimeout(function(){n.grep(i,function(t){return n("#"+t).data("popupoptions").scrolllock}).length||v.css({overflow:"visible","margin-right":s})},10);r(t,e[t.id],o.closetransitionend)});else o.detach?f.detach():f.hide(),o.scrolllock&&setTimeout(function(){n.grep(i,function(t){return n("#"+t).data("popupoptions").scrolllock}).length||v.css({overflow:"visible","margin-right":s})},10),r(t,e[t.id],o.closetransitionend);o.type=="tooltip"&&n(window).off("resize."+t.id)}},toggle:function(i,r){n(i).data("popup-visible")?t.hide(i):setTimeout(function(){t.show(i,r)},0)},reposition:function(t,i){var e=n(t),r=e.data("popupoptions"),u=n("#"+t.id+"_wrapper"),s,o;i=i||0;r.type=="tooltip"?(u.css({position:"absolute"}),s=r.tooltipanchor?n(r.tooltipanchor):r.openelement?n(r.openelement).filter('[data-popup-ordinal="'+i+'"]'):n("."+t.id+c+'[data-popup-ordinal="'+i+'"]'),o=s.offset()||{left:0,top:0},r.horizontal=="right"?u.css("left",o.left+s.outerWidth()+r.offsetleft):r.horizontal=="leftedge"?u.css("left",o.left+r.offsetleft):r.horizontal=="left"?u.css("right",f.width()-o.left-r.offsetleft):r.horizontal=="rightedge"?u.css("right",f.width()-o.left-s.outerWidth()-r.offsetleft):u.css("left",o.left+s.outerWidth()/2-e.outerWidth()/2-parseFloat(e.css("marginLeft"))+r.offsetleft),r.vertical=="bottom"?u.css("top",o.top+s.outerHeight()+r.offsettop):r.vertical=="bottomedge"?u.css("top",o.top+s.outerHeight()-e.outerHeight()+r.offsettop):r.vertical=="top"?u.css("bottom",f.height()-o.top-r.offsettop):r.vertical=="topedge"?u.css("bottom",f.height()-o.top-e.outerHeight()-r.offsettop):u.css("top",o.top+s.outerHeight()/2-e.outerHeight()/2-parseFloat(e.css("marginTop"))+r.offsettop)):r.type=="overlay"&&(r.horizontal?u.css("text-align",r.horizontal):u.css("text-align","center"),r.vertical?e.css("vertical-align",r.vertical):e.css("vertical-align","middle"),r.absolute&&u.css({position:"absolute",top:window.scrollY}),r.background||(u.css({"pointer-events":"none"}),r.absolute||b(t)||(e.css("overflow","auto"),e[0].style.WebkitOverflowScrolling="touch",e.css("max-height","calc(100% - "+e.css("margin-top")+" - "+e.css("margin-bottom")+")"))))},addclosebutton:function(t){var i;i=n(t).data("popupoptions").closebuttonmarkup?n(o.closebuttonmarkup).addClass(t.id+"_close"):'<button class="popup_close '+t.id+'_close" title="Close" aria-label="Close"><span aria-hidden="true">×<\/span><\/button>';n(t).data("popup-initialized")&&n(t).append(i)}},r=function(t,i,r){var u=n(t).data("popupoptions"),f,e;typeof u!="undefined"&&(f=u.openelement?u.openelement:"."+t.id+c,e=n(f+'[data-popup-ordinal="'+i+'"]'),typeof r=="function"&&r.call(n(t),t,e))},b=function(n){var t=n.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},y;n(document).on("keydown",function(r){if(i.length){var f=i[i.length-1],u=document.getElementById(f);n(u).data("popupoptions").escape&&r.keyCode==27&&t.hide(u)}});n(document).on("mousedown",function(n){y=n.target});n(document).on("click",function(r){if(i.length){var f=i[i.length-1],u=document.getElementById(f),e=n(u).data("popupoptions").closeelement?n(u).data("popupoptions").closeelement:"."+u.id+v;n(r.target).closest(e).length&&(r.preventDefault(),t.hide(u));n(u).data("popupoptions")&&n(u).data("popupoptions").blur&&!n(r.target).closest(n(u).data("popupoptions").blurignore).length&&!n(r.target).closest("#"+f).length&&!n(y).closest("#"+f).length&&r.which!==2&&n(r.target).is(":visible")&&(n(u).data("popupoptions").background?(t.hide(u),r.preventDefault()):t.hide(u,!0))}});n(document).on("keydown",function(t){if(i.length&&t.which==9){var o=i[i.length-1],u=document.getElementById(o),s=n(u).data("popupoptions");if(!s.keepfocus)return;var h=n(u).find("*"),r=h.filter(w).filter(":visible"),c=n(":focus"),f=r.length,e=r.index(c);f===0?(n(u).focus(),t.preventDefault()):t.shiftKey?e===0&&(r.get(f-1).focus(),t.preventDefault()):e==f-1&&(r.get(0).focus(),t.preventDefault())}});n.fn.popup=function(i){return this.each(function(){var r=n(this),u=n.extend(!0,{},n.fn.popup.defaults),f;i&&i.type==="tooltip"&&(u.background=!1);typeof i=="object"?(f=n.extend({},u,r.data("popupoptions"),i),r.data("popupoptions",f),o=r.data("popupoptions"),t._init(this)):typeof i=="string"?(r.data("popupoptions")||(r.data("popupoptions",u),o=r.data("popupoptions")),t[i].call(this,this)):(r.data("popupoptions")||(r.data("popupoptions",u),o=r.data("popupoptions")),t._init(this))})};n.fn.popup.destroyall=function(){for(var t=0;t<i.length;t++)n("#"+i[t]).popup("hide");n(".popup_wrapper").remove();n(".popup_background").remove();n(document).off("click.jqp")};n.fn.popup.defaults={type:"overlay",absolute:!1,autoopen:!1,background:!0,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:!0,blur:!0,blurignore:null,setzindex:!0,autozindex:!1,scrolllock:!1,closebutton:!1,closebuttonmarkup:null,keepfocus:!0,focuselement:null,focusdelay:50,outline:!1,pagecontainer:null,detach:!1,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null}})(jQuery),function(n){n.fn.draggableTouch=function(t){return("ontouchstart"in document.documentElement)?t=="disable"?(this.unbind("touchstart"),this.unbind("touchmove"),this.unbind("touchend"),this.unbind("touchcancel"),this):(this.each(function(){var t=n(this),i=null,r=function(n){n.preventDefault();var r=n.originalEvent;t.trigger("dragend",{top:r.changedTouches[0].pageY-i.y,left:r.changedTouches[0].pageX-i.x})};t.bind("touchstart",function(r){var f=r.originalEvent,u=n(this).offset();i={x:f.changedTouches[0].pageX-u.left,y:f.changedTouches[0].pageY-u.top};t.trigger("dragstart",u)});t.bind("touchmove",function(t){t.preventDefault();var r=t.originalEvent;r.targetTouches.length>1||n(this).css({top:r.changedTouches[0].pageY-i.y,left:r.changedTouches[0].pageX-i.x})});t.bind("touchend",r);t.bind("touchcancel",r)}),this):this.draggableMouse(t)};n.fn.draggableMouse=function(t){return t=="disable"?(this.unbind("mousedown"),this.unbind("mouseup"),this):(this.each(function(){var t=n(this),i=null,r=function(n){t.css({top:n.pageY-i.y,left:n.pageX-i.x})},u=function(f){t.unbind("mouseup",u);n(document).unbind("mousemove",r);t.trigger("dragend",{top:f.pageY-i.y,left:f.pageX-i.x})};t.bind("mousedown",function(f){var e=t.offset();i={x:f.pageX-e.left,y:f.pageY-e.top};n(document).bind("mousemove",r);t.bind("mouseup",u);t.trigger("dragstart",e)})}),this)}}(jQuery);